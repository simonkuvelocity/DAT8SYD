function createGumroadOverlay(){window.GumroadOverlay||(window.GumroadOverlay=new GumroadOverlayManager)}!function(){var t=!1,i=/xyz/.test(function(){})?/\b_super\b/:/.*/;this._GumroadClass=function(){},_GumroadClass.extend=function(e){function a(){!t&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;t=!0;var r=new this;t=!1;for(var o in e)r[o]="function"==typeof e[o]&&"function"==typeof n[o]&&i.test(e[o])?function(t,i){return function(){var e=this._super;this._super=n[t];var a=i.apply(this,arguments);return this._super=e,a}}(o,e[o]):e[o];return a.prototype=r,a.prototype.constructor=a,a.extend=arguments.callee,a}}();var GumroadClass=_GumroadClass.extend({setEnvironment:function(){this.environment="production",this.domain={development:"http://localhost:3333",production:"https://gumroad.com",staging:"https://staging.gumroad.com",staging_x:"https://staging-x.gumroad.com"}[this.environment],this.isMobile=navigator.userAgent.match(/Mobile[\/; ]/i)||navigator.userAgent.match(/Opera (Mini|Mobi)/i)||navigator.userAgent.match(/IEMobile/i),this[this.environment]=!0,this.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},startNodeAdditionObserver:function(){MutationObserver&&(this.nodeAdditionObserver=new MutationObserver(function(t){for(var i=0;i<t.length;i++)for(var e=0;e<t[i].addedNodes.length;e++)this.nodeAdditionCallback&&this.nodeAdditionCallback(t[i].addedNodes[e])}.bind(this)),this.nodeAdditionObserver.observe(document.body,{childList:!0,subtree:!0}))}}),GumroadLink=GumroadClass.extend({init:function(t,i){this.element=t,this.manager=i,this.vars={as_modal:!0,referrer:encodeURIComponent(document.referrer+"/"+window.location.search.substring(1)),url_parameters:{source_url:encodeURIComponent(window.location.href)}},this.validateUrl()},validParams:"locale referrer wanted email gift monthly quarterly biannually yearly recommended_by".split(/\s+/),makeActiveLink:function(){var t=document.createElement("span"),i=this,e=!1;if(t.className=this.manager.logoClassName,this.manager.hasClass(this.element,"gumroad-button")){if(this.element.hasChildNodes())for(var a=0;a<this.element.childNodes.length;a++){var n=this.element.childNodes[a];"span"===n.nodeName.toLowerCase()&&this.manager.hasClass(n,this.manager.logoClassName)&&(e=!0)}e||this.element.insertBefore(t,this.element.firstChild)}if(!this.manager.isMobile){if(this.element.getAttribute("data-gumroad-default-cover")){var r=document.createElement("img");r.src=this.manager.domain+"/products/"+this.vars.permalink+"/default_cover",this.element.insertBefore(r,this.element.firstChild)}this.element.getAttribute("data-gumroad-single-product")&&(this.manager.isSingleProductMode=!0),this.origin!==this.manager.domain&&(this.element.target="_blank"),this.element.onclick=function(t){t.preventDefault(),i.manager.showInIframe(i)}}},setUrlVars:function(t){if(t){var i=t.split("&");if(i.length)for(var e=0;e<i.length;e++)if(i[e]){var a=i[e].split("=");2===a.length&&(this.validParams.indexOf(a[0])>-1?this.vars[a[0]]=a[1]:this.vars.url_parameters[a[0]]=a[1])}}},validateUrl:function(){for(var t=this.element.href.split("?"),i=t[0],e=0;e<this.manager.productMatches.length;e++){var a=this.manager.productMatches[e];if(0===i.indexOf(a)){var n=i.replace(a,"").split("/");return this.vars.permalink=n[0],n[1]&&n[1].length>0&&(this.vars.offerCodeName=n[1]),this.setUrlVars(t[1]),this.manager.links.push(this),this.manager.allPermalinks.indexOf(this.vars.permalink)<0&&this.manager.allPermalinks.push(this.vars.permalink),this.manager.allPermalinks=this.manager.allPermalinks.slice(-4),this.makeActiveLink(),!0}}delete this}}),GumroadOverlayManager=GumroadClass.extend({init:function(t){this.setEnvironment(),this.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),this.links=[],this.allPermalinks=[],window.addEventListener?window.addEventListener("message",function(t){this.gotMessage(t)}.bind(this),!1):window.attachEvent("onmessage",function(t){this.gotMessage(t)}.bind(this),!1),this.insertStylesheet(),this.insertLoadingIndicator(),this.bindKeys(),this.addLinks(),this.domain!==this.origin&&1===this.links.length&&(this.isSingleProductMode=!0),this.createIframe(),this.startNodeAdditionObserver()},addClass:function(t,i){var e=t.classList.toString().split(/\s+/);this.hasClass(t,i)&&(e.push(i),t.className=className.join(" "))},addLinks:function(){for(var t=document.getElementsByTagName("a"),i=this,e=0;e<t.length;e++)new GumroadLink(t[e],i)},append:function(t,i){i=i?i:"body",document.getElementsByTagName(i)[0].appendChild(t)},askForProduct:function(){this.currentLink&&this.messageIframe({overlayMethod:"getProduct",overlayArgs:this.currentLink.vars})},bindKeys:function(){document.onkeydown=function(t){27===t.keyCode&&this.minimizeIframe()}.bind(this)},buildIframeSrc:function(){var t=(this.domain?this.domain:"")+"/overlay_page",i=[];if(this.isSingleProductMode&&i.push("single_product_mode=true"),this.allPermalinks&&this.allPermalinks.length>0&&i.push("all_permalinks="+this.allPermalinks.join(",")),this.currentLink)for(var e in this.currentLink.vars)this.currentLink.vars.hasOwnProperty(e)&&i.push(e+"="+this.currentLink.vars[e]);return i.length>0&&(t+="?"+i.join("&")),t},createIframe:function(){var t=this;this.iframe&&(this.iframe.remove(),delete this.iframe,delete this.iframeReady),this.iframe=document.createElement("iframe"),this.iframe.allowtransparency=!0,this.iframe.className="gumroad-overlay-iframe",this.iframe.onload=function(){t.setupMessaging()},this.iframe.src=this.buildIframeSrc(),this.append(this.iframe)},gotMessage:function(t){var i={};if(t.data)try{i=JSON.parse(t.data)}catch(e){}i.parentMethod&&this[i.parentMethod]&&this[i.parentMethod](i.parentArgs)},handshake:function(){this.iframeReady||(this.iframeReady=!0,clearInterval(this.handshakeTimer),delete this.handshakeTimer,this.messagingSetupCallback())},hasClass:function(t,i){return t.classList.toString().split(/\s+/).indexOf(i)>-1},hideLoadingIndicator:function(){this.setOpacity(this.loadingIndicator,0)},insertLoadingIndicator:function(){this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="gumroad-loading-indicator",this.loadingIndicator.appendChild(document.createElement("i")),this.append(this.loadingIndicator)},insertStylesheet:function(){var t='a.gumroad-button { background-color: white !important; background-image: url("GUMROAD_ORIGIN/button/button_bar.jpg") !important; background-repeat: repeat-x !important; border-radius: 4px !important; box-shadow: rgba(0, 0, 0, .4) 0 0 2px !important; color: #999 !important; display: inline-block !important; font-family: -apple-system, ".SFNSDisplay-Regular", "Helvetica Neue", Helvetica, Arial, sans-serif !important; font-size: 16px !important; font-style: normal !important; font-weight: 500 !important; line-height: 50px !important; padding: 0 15px !important; text-shadow: none !important; text-decoration: none !important; } .gumroad-button-logo { background-image: url("GUMROAD_ORIGIN/button/button_logo.png") !important; background-size: cover !important; height: 17px !important; width: 16px !important; display: inline-block !important; margin-bottom: -3px !important; margin-right: 15px !important; } .gumroad-loading-indicator { background: white; border-radius: 50%; box-shadow: 0 1px 2px rgba(0, 0, 0, .1); box-sizing: border-box; display: none; height: 60px; left: 50% !important; margin-left: -30px !important; margin-top: -30px !important; padding: 10px; position: fixed; top: 50% !important; width: 60px; z-index: 99997; } .gumroad-loading-indicator i { background: url("GUMROAD_ORIGIN/js/loading-rainbow.svg"); height: 40px; width: 40px; display: inline-block; background-size: contain; -webkit-animation: gumroad-spin 1.5s infinite linear; animation: gumroad-spin 1.5s infinite linear; } .gumroad-overlay-iframe { position: fixed !important; overflow: hidden !important; z-index: 99998 !important; top: 0 !important; right: 0 !important; width: 0; height: 0; border: none !important; margin: 0 !important; padding: 0 !important; zoom: 1; } @-webkit-keyframes gumroad-spin { 0% { -webkit-transform: rotate(0deg); transform: rotate(0deg); } 100% { -webkit-transform: rotate(359deg); transform: rotate(359deg); } } @keyframes gumroad-spin { 0% { -webkit-transform: rotate(0deg); transform: rotate(0deg); } 100% { -webkit-transform: rotate(359deg); transform: rotate(359deg); } } '.replace(/GUMROAD_ORIGIN/g,this.domain),i=document.createElement("style");i.type="text/css",i.appendChild(document.createTextNode(t)),this.append(i,"head")},logoClassName:"gumroad-button-logo",maximizeIframe:function(){this.hideLoadingIndicator(),this.resizeIframe({height:"100%",width:"100%"}),this.messageIframe({overlayMethod:"maximizeCallback"})},messageIframe:function(t){this.iframe&&("object"==typeof t&&(t=JSON.stringify(t)),this.iframe.contentWindow.postMessage(t,this.domain))},messagingSetupCallback:function(){this.askForProduct(),this.messageIframe({overlayMethod:"getPersistentBundle"})},minimizeIframe:function(t){this.hideLoadingIndicator(),this.resizeIframe(t),this.messageIframe({overlayMethod:"minimizeCallback"})},nodeAdditionCallback:function(){this.resetLinks()},redirect:function(t){t&&t.match(/^http/)&&(delete this,window.location.href=t)},reload:function(){this.minimizeIframe(),this.resetLinks()},removeClass:function(t,i){for(;this.hasClass(t,i);){var e=t.classList.toString().split(/\s+/),a=e.indexOf(i);a>-1&&e.splice(a,1),t.className=e.join(" ")}},resetLinks:function(){this.links=[],this.addLinks()},resizeIframe:function(t){this.iframe&&(t=t?t:{width:"0px",height:"0px"},t.width&&(this.iframe.style.width=t.width),t.height&&(this.iframe.style.height=t.height))},sendDomain:function(){this.messageIframe({overlayMethod:"setOverlayParentDomain",overlayArgs:this.origin})},setEnvironment:function(){this._super(),this.test&&(this.domain=this.origin),this.productMatches={development:["http://l.h:3333/l/","http://local.host:3333/l/","http://localhost:3333/l/"],production:["http://gum.co/","https://gum.co/","https://gumroad.com/l/"],staging:["http://staging.gum.co/","https://staging.gum.co/","https://staging.gumroad.com/l/"],staging_x:["https://staging-x.gumroad.com/l/"],test:["http://test/l/"]}[this.environment]},setOpacity:function(t,i){t.style.display=0===i?"none":"block",t.style.opacity=t.style.MozOpacity=t.style.khtmlOpacity=i,t.style.filter="alpha(opacity="+100*i+");"},setupMessaging:function(){this.handshakeTimer=setInterval(function(){this.sendDomain()}.bind(this),100)},showInIframe:function(t){this.currentLink=t,this.showLoadingIndicator(),this.iframeReady?this.askForProduct():this.createIframe()},showLoadingIndicator:function(){this.setOpacity(this.loadingIndicator,1)},showSingleProduct:function(){this.maximizeIframe(),this.messageIframe({overlayMethod:"setIsSingleLink"}),this.messageIframe({overlayMethod:"refreshPreview"})}});window.addEventListener?window.addEventListener("load",createGumroadOverlay):window.attachEvent&&window.attachEvent("onload",createGumroadOverlay);